[["index.html", "REDUS Framework User Manuals Preface 0.1 User Guides 0.2 Developer Guides", " REDUS Framework User Manuals Ibrahim Umar 2021-09-25 Preface This book will explain about the REDUS Framework and its supporting tools. Here are the overview of the book 0.1 User Guides 0.1.1 REDUS Framework REDUS Framework (Cloud) User Guides REDUS Framework (R script) User Guides 0.1.2 Supporting formats and tools The REDUS master recipe format for automated survey time series processing Using the REDUStools R package and the master recipe to process one or more survey time series 0.2 Developer Guides 0.2.1 REDUS Framework backend Setting up REDUS Framework API Server Setting up REDUS Framework Cloud Server Adding new assessment 0.2.2 Other useful tools Survey Time Series Downloader "],["RF-cloud-guide.html", "1 REDUS Framework (Cloud) User Manual 1.1 Pre-requisites 1.2 Starting up 1.3 Selecting an assessment 1.4 Configuring an assessment 1.5 Running the assessment", " 1 REDUS Framework (Cloud) User Manual Welcome to the user manual of the REDUS Framework. This guide will show you the step-by-step guide for running the assessment workflow using the REDUS Framework cloud application. 1.1 Pre-requisites An internet browser. (Optional) Experience in the REDUS Survey Time Series XML Recipe guide. 1.2 Starting up Point your browser to the URL of the REDUS framework: http://myrto.hi.no:3000 Note that the above URL can change You’ll be greeted with the assessment selection page as below: 1.3 Selecting an assessment You may select the available assessment from the drop-down list. select assessment After selecting an assessment, click on Run assessment now button if you want to use the pre-defined configuration and data. Otherwise, click the Configure selected assessment button to configure the selected assessment prior to its run. TIPS: You can run multiple assessments in parallel if you wish to do that. Simply open a new browser tab and select another assessment to run. 1.4 Configuring an assessment As of now, the supported configuration of an assesment are: Survey data Assessment program selection NOTE: Support for catch and acoustic data is not yet supported. 1.4.1 Configure the survey data To configure the survey data input, click on the Input data on the left hand side menu and select Survey data on the tab menu. You will be presented by the list of survey data (by fleets) that is included in the assessment. configure survey Each of these survey data can be individually modified using the drop down selection below the survey name. The supported actions are: As is : This means that you don’t want to modify the pre-defined data that comes with the assessment. (Official) Pre-computed values : Choose this to use the official result from the nightly StoX survey time series run. &gt; NOTE: The official results are currently available here: http://astarte.imr.no/ocpu/library/REDUStools/www/imrsts.html . This was generated and served using the REDUStools R package available here: https://github.com/REDUS-IMR/REDUStools. Re-process using StoX : This option will force the survey time series re-processing using StoX/Rstox. For this you will need to fill-in the recipe for the StoX processing. The recipe is an XML document. Below is a sample recipe for the Barents Sea Northeast Arctic cod bottom trawl index in winter survey time series: &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;redus_master xmlns=&quot;http://www.imr.no/formats/redus/master/v0.1&quot; revision=&quot;1&quot; version=&quot;0.1&quot;&gt; &lt;configuration&gt; &lt;saveOutputTable&gt;true&lt;/saveOutputTable&gt; &lt;saveRunStatus&gt;false&lt;/saveRunStatus&gt; &lt;/configuration&gt; &lt;globalParameter&gt; &lt;!-- &lt;fileFix from=&quot;biotic_cruiseNumber_1994001_Anny+KrÃ¦mer.xml&quot; to=&quot;biotic_cruiseNumber_1994001_Anny+Kræmer.xml&quot;/&gt; --&gt; &lt;/globalParameter&gt; &lt;parameters sts=&quot;Barents Sea Northeast Arctic cod bottom trawl index in winter&quot; revision=&quot;1&quot; version=&quot;0.1&quot;&gt; &lt;configuration&gt; &lt;stsName&gt;Barents Sea Northeast Arctic cod bottom trawl index in winter&lt;/stsName&gt; &lt;overwriteNMD&gt;false&lt;/overwriteNMD&gt; &lt;forceReProcess&gt;true&lt;/forceReProcess&gt; &lt;forceBioticV3&gt;true&lt;/forceBioticV3&gt; &lt;skipYear&gt;1993&lt;/skipYear&gt; &lt;startYear&gt;&lt;/startYear&gt; &lt;endYear&gt;&lt;/endYear&gt; &lt;levelRequested&gt;bootstrapImpute&lt;/levelRequested&gt; &lt;bootstrapSeed&gt;77&lt;/bootstrapSeed&gt; &lt;bootstrapImputeSeed&gt;101&lt;/bootstrapImputeSeed&gt; &lt;bootstrapIter&gt;5&lt;/bootstrapIter&gt; &lt;coresUse&gt;1&lt;/coresUse&gt; &lt;groupType&gt;age&lt;/groupType&gt; &lt;minAge&gt;1&lt;/minAge&gt; &lt;maxAge&gt;12&lt;/maxAge&gt; &lt;plusAge&gt;7&lt;/plusAge&gt; &lt;numberScale&gt;1000000&lt;/numberScale&gt; &lt;dataType&gt;survey&lt;/dataType&gt; &lt;applyOverrides&gt;false&lt;/applyOverrides&gt; &lt;/configuration&gt; &lt;override&gt; &lt;!-- &lt;parameter name=&quot;UseProcessData&quot;&gt;true&lt;/parameter&gt; --&gt; &lt;/override&gt; &lt;/parameters&gt; &lt;/redus_master&gt; NOTE: The documentation for the recipe is here. reprocess survey using StoX Input manual values : Here you can input manual values in the text format for the specified survey data. 1.4.2 Configure the assessment program To select the available assessment program, click on the Assessment from the left hand side menu. You’ll be presented by the information of the current assessment used in the model and a drop down selection of Latest SAM and Latest XSAM option. select assessment NOTE: Latest SAM and XSAM is using the master branch of the https://github.com/fishfollower/SAM repository, the only difference is XSAM will try to use the covariance matrices from the StoX output 1.4.3 Finish configuring If you are finished with configuring, please click the Run assessment now button to run the assessment workflow using your defined configuration. 1.5 Running the assessment After clicking the Run assessment now button, there will be a popup that shows the status of the provisioning process before the assessment is run: select assessment Sit back and wait until the provision is complete, in which indicated by the assessment run dashboard: select assessment There are some important elements in the dashboard: change button: This enables you to re-start a new assessment workflow. destroy button: This will irreversibly destroy the current running assessment. There is also a direct URL link to the run. With this link you can resume the current assessment from anywhere as long as you can connect to the REDUS framework server. For example you might run the assessment from your office computer and wanted to get the results later from your home computer (e.g., via VPN). Sets of tab menu items: File Manager: This tab provides an interface that is similar to Windows Explorer that can be used to explore files and to upload/download files from the current assessment workflow. Console: This tab provides a Linux console for the current assessment workflow. You can run R and experiment with stuffs. Logs: This tab provides useful logs (outputs, warnings, errors) for the current assessment workflows. This is used mostly for debugging and finding errors. Reports: After the assessment finishes, this tab will be active and provides the report and a link to the downloadable artifacts from the assessment workflow run. "],["RF-script-guide.html", "2 REDUS Framework (R Script) User Manual 2.1 Pre-requisites 2.2 Getting the REDUS Framework container template 2.3 Prepare an ID 2.4 Get the assessment bundle (code and data) 2.5 Configure the assessment 2.6 Build and run the REDUS Framework container 2.7 Examine the run 2.8 Stopping the run 2.9 (Advanced) Parsing the status of the run", " 2 REDUS Framework (R Script) User Manual This manual will guide you to prepare an assessment to be run in the REDUS framework by using only R scripting methods. 2.1 Pre-requisites To be able to follow this guide, you must have these components ready on your system: A working Docker installation (https://www.docker.com/get-started). An R application. R package yaml, git2r, jsonlite and bibtex installed. install.packages(c(&quot;yaml&quot;, &quot;git2r&quot;, &quot;jsonlite&quot;,&quot;bib2df&quot;)) ## Installing packages into &#39;/home/runner/work/_temp/Library&#39; ## (as &#39;lib&#39; is unspecified) ## also installing the dependencies &#39;sys&#39;, &#39;fansi&#39;, &#39;pkgconfig&#39;, &#39;purrr&#39;, &#39;cli&#39;, &#39;crayon&#39;, &#39;utf8&#39;, &#39;askpass&#39;, &#39;ellipsis&#39;, &#39;generics&#39;, &#39;lifecycle&#39;, &#39;R6&#39;, &#39;tibble&#39;, &#39;tidyselect&#39;, &#39;vctrs&#39;, &#39;pillar&#39;, &#39;Rcpp&#39;, &#39;curl&#39;, &#39;mime&#39;, &#39;openssl&#39;, &#39;dplyr&#39;, &#39;humaniformat&#39;, &#39;httr&#39; 2.2 Getting the REDUS Framework container template First, we need to download the REDUS Framework container template from Github. This template provides the skeleton that will automate the assessment processing. The template is available at https://github.com/REDUS-IMR/docker-redus-pipeline. # (Optional) Set a working directory setwd(tempdir()) # Clone the template git2r::clone(&quot;https://github.com/REDUS-IMR/docker-redus-pipeline.git&quot;, &quot;redus-framework&quot;) ## cloning into &#39;redus-framework&#39;... ## Receiving objects: 2% (1/43), 8 kb ## Receiving objects: 11% (5/43), 8 kb ## Receiving objects: 23% (10/43), 8 kb ## Receiving objects: 32% (14/43), 8 kb ## Receiving objects: 41% (18/43), 8 kb ## Receiving objects: 51% (22/43), 8 kb ## Receiving objects: 62% (27/43), 8 kb ## Receiving objects: 72% (31/43), 8 kb ## Receiving objects: 81% (35/43), 8 kb ## Receiving objects: 93% (40/43), 8 kb ## Receiving objects: 100% (43/43), 8 kb, done. ## Local: master /tmp/RtmpojiQXs/redus-framework ## Remote: master @ origin (https://github.com/REDUS-IMR/docker-redus-pipeline.git) ## Head: [e99d35b] 2020-03-09: Put results in tmp to be picked by nginx path # Go into redus-framework/projects as we will mostly work from this directory setwd(&quot;redus-framework/projects&quot;) 2.3 Prepare an ID Before preparing the assessment files, you must write a unique ID for the framework run in a file named id.conf in the redus-framework/projects directory. This ID is necessary for the several web services in the container to run. ID &lt;- &quot;0000&quot; fileConn &lt;- file(&quot;id.conf&quot;) writeLines(ID, fileConn) close(fileConn) 2.4 Get the assessment bundle (code and data) REDUS Framework works best with any ICES TAF -based assessment bundles. However, any assessment bundles from stockassessment.org will work too with some slight modifications. REDUS Framework Github repository provides two example assessments for users to tryout: North East Artic Cod in 2018 (TAF based) [link] Norwegian Sea Herring in 2019 (Stockassessment.org based) [link] Read more about converting your own assessment into REDUS Framework in this guide (TODO). For this example let’s use the NEA Cod 2018 Assessment. # Download from Github download.file(&quot;https://github.com/REDUS-IMR/redus-framework/raw/master/extra/neacod-2018.tgz&quot;, &quot;neacod-2018.tgz&quot;) # See the content of the file untar(&quot;neacod-2018.tgz&quot;, list = TRUE) ## [1] &quot;neacod-2018/&quot; ## [2] &quot;neacod-2018/data.R&quot; ## [3] &quot;neacod-2018/output.R&quot; ## [4] &quot;neacod-2018/model.R&quot; ## [5] &quot;neacod-2018/README.md&quot; ## [6] &quot;neacod-2018/report.R&quot; ## [7] &quot;neacod-2018/bootstrap/&quot; ## [8] &quot;neacod-2018/bootstrap/initial/&quot; ## [9] &quot;neacod-2018/bootstrap/initial/data/&quot; ## [10] &quot;neacod-2018/bootstrap/initial/data/nm.dat&quot; ## [11] &quot;neacod-2018/bootstrap/initial/data/cw.dat&quot; ## [12] &quot;neacod-2018/bootstrap/initial/data/cn.dat&quot; ## [13] &quot;neacod-2018/bootstrap/initial/data/mo.dat&quot; ## [14] &quot;neacod-2018/bootstrap/initial/data/nmOldAdj.dat&quot; ## [15] &quot;neacod-2018/bootstrap/initial/data/pcc.zip&quot; ## [16] &quot;neacod-2018/bootstrap/initial/data/pm.dat&quot; ## [17] &quot;neacod-2018/bootstrap/initial/data/pf.dat&quot; ## [18] &quot;neacod-2018/bootstrap/initial/data/survey.dat&quot; ## [19] &quot;neacod-2018/bootstrap/initial/data/lf.dat&quot; ## [20] &quot;neacod-2018/bootstrap/initial/data/lw.dat&quot; ## [21] &quot;neacod-2018/bootstrap/initial/data/survey_var.dat&quot; ## [22] &quot;neacod-2018/bootstrap/initial/data/sw.dat&quot; ## [23] &quot;neacod-2018/bootstrap/initial/data/dw.dat&quot; ## [24] &quot;neacod-2018/bootstrap/initial/config/&quot; ## [25] &quot;neacod-2018/bootstrap/initial/config/model.cfg&quot; ## [26] &quot;neacod-2018/bootstrap/DATA.bib&quot; ## [27] &quot;neacod-2018/bootstrap/SOFTWARE.bib&quot; ## [28] &quot;neacod-2018/utilities.R&quot; # Unpack it untar(&quot;neacod-2018.tgz&quot;) # Remove the compressed file as we don&#39;t need it anymore unlink(&quot;neacod-2018.tgz&quot;) NOTE: It’s possible to have more than one assessment bundle. Just extract the another more assesssment bundles in the current redus-framework/projects directory. 2.5 Configure the assessment 2.5.1 Processing directives All REDUS Framework configuration is stored in a configuration file redus.yaml. This file should be placed in the redus/ directory of the assessment bundle. The configuration should start with these 3 lines: default: redustools.remote: &quot;http://astarte.imr.no/ocpu/library/REDUStools/&quot; survey: &quot;bootstrap/initial/data/survey.dat&quot; The redustools.remote tells the framework the location of the REDUS Framework API Server endpoint. And survey tells the framework the survey data file that is used in the assessment. Let’s build this using R: # Create the default configuration configuration &lt;- list(default = list( redustools.remote=&quot;http://astarte.imr.no/ocpu/library/REDUStools/&quot;, survey = &quot;bootstrap/initial/data/survey.dat&quot;)) # Check the output cat(yaml::as.yaml(configuration)) ## default: ## redustools.remote: http://astarte.imr.no/ocpu/library/REDUStools/ ## survey: bootstrap/initial/data/survey.dat 2.5.1.1 Survey data To apply processing step to any survey indexes, we must examine the content of the survey file (e.g., bootstrap/initial/data/survey.dat and note down the fleet names (e.g., NorBarTrSur, NorBarLofAcSur, etc.). The processing mode can be either: asis: This means that you don’t want to modify the pre-defined data that comes with the assessment. remote: Choose this to use the official result from the nightly StoX survey time series run. &gt; NOTE: The official results are currently available here: http://astarte.imr.no/ocpu/library/REDUStools/www/imrsts.html . This was generated and served using the REDUStools R package available here: https://github.com/REDUS-IMR/REDUStools. build: This option will force the survey time series re-processing using StoX/Rstox. For this you will need to fill-in the recipe for the StoX processing. The recipe is an XML document as. See here for more detailed information. Later you will need to save the recipe as an XML file (e.g., NorBarTrSur.xml). See below for an example. manual: Here you can input manual values in the text format for the specified survey data. Below are some examples to apply an extra processing to the NorBarTrSur survey index data. a. Re-Build the index using StoX (build mode) We want to use StoX to re-process the “Barents Sea Northeast Arctic cod bottom trawl index in winter” survey time series from NMD, using the Recipe XML file available from here: https://git.imr.no/snippets/8. # Create redus configuration directory dir.create(&quot;neacod-2018/redus&quot;) # Prepare XML recipe download.file(&quot;https://git.imr.no/-/snippets/8/raw/master/snippetfile1.txt?inline=false&quot;, &quot;neacod-2018/redus/NorBarTrSur.xml&quot;) # Prepare configuration (YAML) ## Important prefix prefix &lt;- &quot;survey.update.&quot; ## The id of the survey configuration, (1 for the 1st, 2 for the 2nd, etc...) iter &lt;- 1 ## The name of the target survey index survey &lt;- &quot;NorBarTrSur&quot; ## Process type (can be either &#39;asis&#39;, &#39;remote&#39;, &#39;build&#39; or &#39;manual&#39;) configuration[[&quot;default&quot;]][[paste0(prefix, iter, &#39;.mode&#39;)]] &lt;- &quot;build&quot; ## REDUS Master recipe if mode is set to &quot;build&quot; configuration[[&quot;default&quot;]][[paste0(prefix, iter, &#39;.surveyBuildConf&#39;)]] &lt;- &quot;./redus/NorBarTrSur.xml&quot; ### Try to use Age information from the pre-defined data configuration[[&quot;default&quot;]][[paste0(prefix, iter, &#39;.useSourceAge&#39;)]] &lt;- &quot;true&quot; ### Try to use Year information from the pre-defined data configuration[[&quot;default&quot;]][[paste0(prefix, iter, &#39;.useSourceYear&#39;)]] &lt;- &quot;true&quot; ## Name of the header target in survey.dat file configuration[[&quot;default&quot;]][[paste0(prefix, iter, &#39;.header&#39;)]] &lt;- survey ## Leave these two below as empty, these are the manual data input ## in text mode (each for index and covar) configuration[[&quot;default&quot;]][[paste0(prefix, iter, &#39;.data&#39;)]] &lt;- &quot;&quot; configuration[[&quot;default&quot;]][[paste0(prefix, iter, &#39;.data_var&#39;)]] &lt;- &quot;&quot; ## We can leave below as empty as this is needed only for &quot;remote&quot; mode configuration[[&quot;default&quot;]][[paste0(prefix, iter, &#39;.stssource&#39;)]] &lt;- &quot;&quot; configuration[[&quot;default&quot;]][[paste0(prefix, iter, &#39;.stsdate&#39;)]] &lt;- &quot;&quot; b. Replace an index using the official result (remote mode) ## The id of the survey configuration (2 = second) iter &lt;- 2 ## The name of the target survey index survey &lt;- &quot;NorBarLofAcSur&quot; ## Process type (can be either &#39;asis&#39;, &#39;remote&#39;, &#39;build&#39; or &#39;manual&#39;) configuration[[&quot;default&quot;]][[paste0(prefix, iter, &#39;.mode&#39;)]] &lt;- &quot;remote&quot; ## These are the necessary directive for the &quot;remote&quot; mode ### Survey time series name (from Dataset Explorer) configuration[[&quot;default&quot;]][[paste0(prefix, iter, &#39;.stssource&#39;)]] &lt;- &quot;Barents Sea Northeast Arctic cod bottom trawl index in winter&quot; ### Set a snapshot date if necessary configuration[[&quot;default&quot;]][[paste0(prefix, iter, &#39;.stsdate&#39;)]] &lt;- &quot;&quot; ### Try to use Age information from the pre-defined data configuration[[&quot;default&quot;]][[paste0(prefix, iter, &#39;.useSourceAge&#39;)]] &lt;- &quot;true&quot; ### Try to use Year information from the pre-defined data configuration[[&quot;default&quot;]][[paste0(prefix, iter, &#39;.useSourceYear&#39;)]] &lt;- &quot;false&quot; ## Name of the header target in survey.dat file configuration[[&quot;default&quot;]][[paste0(prefix, iter, &#39;.header&#39;)]] &lt;- survey ## Below is not used in the &#39;remote&#39; mode configuration[[&quot;default&quot;]][[paste0(prefix, iter, &#39;.surveyBuildConf&#39;)]] &lt;- &quot;&quot; ## Leave these two below as empty, these are the manual data input ## in text mode (each for index and covar) configuration[[&quot;default&quot;]][[paste0(prefix, iter, &#39;.data&#39;)]] &lt;- &quot;&quot; configuration[[&quot;default&quot;]][[paste0(prefix, iter, &#39;.data_var&#39;)]] &lt;- &quot;&quot; Write the configuration You must write the configuration back to the assessment bundle. ## Write configuration to the root of the assessment directory yaml::write_yaml(configuration, &quot;neacod-2018/redus/redus.yaml&quot;) 2.5.1.2 Assessment program To change the assessment program, you need to open the bootstrap/SOFTWARE.bib file and change the source value in the stockassessment item: # Read Software BIB df &lt;- bib2df::bib2df(&quot;neacod-2018/bootstrap/SOFTWARE.bib&quot;) # Peek the pre-defined program print(df[1, &quot;SOURCE&quot;]) ## # A tibble: 1 × 1 ## SOURCE ## &lt;chr&gt; ## 1 fishfollower/SAM/stockassessment@a295ef2 # Change assessment program to the latest SAM df[1, &quot;SOURCE&quot;] &lt;- &quot;fishfollower/SAM/stockassessment@master&quot; # Write back the change bib2df::df2bib(df, &quot;neacod-2018/bootstrap/SOFTWARE.bib&quot;) In addition to the above, if you are either using SAM or XSAM, it is necessary to write use.SAM or use.XSAM in the REDUS configuration directory: # Notify that we will use XSAM fileConn &lt;- file(&quot;neacod-2018/redus/use.XSAM&quot;) # or SAM #fileConn &lt;- file(&quot;neacod-2018/redus/use.SAM&quot;) writeLines(&quot;&quot;, fileConn) close(fileConn) 2.6 Build and run the REDUS Framework container These are the final step needed to run the assessment. After all the files are ready we can proceed with building the Docker image and run the framework as a Docker container. # Get back to &#39;redus-framework&#39; directory setwd(&quot;..&quot;) # Select a name for the run runname &lt;- &quot;testit&quot; # Select port for the web services port &lt;- 8000 # Build the image Sys.setenv(RUN = runname, PORT = port) system(&quot;docker build --pull --rm -t ${RUN} .&quot;) # Run the image system(&quot;docker run -p ${PORT}:8888 --name ${RUN} -dit ${RUN}&quot;) 2.7 Examine the run As with the cloud version of the REDUS Framework, the run from the script provides the various Web-based tools, namely: 1. File explorer 2. Terminal 3. Logs 4. Results page You can instruct R to open the above URLs using your web browser: # Let&#39;s open the File Explorer browseURL(paste0(&quot;http://localhost:&quot;, port, &quot;/id/&quot;, ID, &quot;/p/workspace/&quot;)) # Let&#39;s open the Terminal browseURL(paste0(&quot;http://localhost:&quot;, port, &quot;/id/&quot;, ID, &quot;/p/terminal&quot;)) # Let&#39;s open the Logs browseURL(paste0(&quot;http://localhost:&quot;, port, &quot;/id/&quot;, ID, &quot;/p/logs&quot;)) # Let&#39;s open the Results page (only available when run is finish with success) browseURL(paste0(&quot;http://localhost:&quot;, port, &quot;/id/&quot;, ID, &quot;/p/report&quot;)) 2.8 Stopping the run Remember to stop the Docker container after you finished to ensure all the memory and disk space used are released: # Kill the run system(&quot;docker kill ${RUN}&quot;) # Cleaning up system(&quot;docker rm ${RUN}&quot;) 2.9 (Advanced) Parsing the status of the run For the brave soul who likes to tinker more with the program, you can utilize the status information to programmatically get the results and/or cleaning up the run. You can use a more advanced scheduler such as taskscheduleR package to automate everything. # Try to print the status status &lt;- jsonlite::fromJSON(paste0(&quot;http://localhost:&quot;, port, &quot;/id/&quot;, ID, &quot;/p/status&quot;)) print(status) # Show me the results ONLY when the run has successfully finished status &lt;- jsonlite::fromJSON(paste0(&quot;http://localhost:&quot;, port, &quot;/id/&quot;, ID, &quot;/p/status&quot;)) # All statuses are 0 means that the pre-processing and the assessment runs # have been finished without errors. if(sum(status$redus) + sum(status$assessement) == 0) { browseURL(paste0(&quot;http://localhost:&quot;, port, &quot;/id/&quot;, ID, &quot;/p/report&quot;)) } "],["redus-master-recipe.html", "3 REDUS Master Recipe 3.1 Examples 3.2 Usage 3.3 Parameter details", " 3 REDUS Master Recipe REDUS framework uses a special kind of recipe to process the IMR Survey Time Series from NMD’s Dataset Explorer. This recipe is formulated in an XML format and contains many user configurable options. 3.1 Examples Below are some recipe samples: 3.1.1 1. Single Survey Time series &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;redus_master xmlns=&quot;http://www.imr.no/formats/redus/master/v0.1&quot; revision=&quot;1&quot; version=&quot;0.1&quot;&gt; &lt;configuration&gt; &lt;saveOutputTable&gt;true&lt;/saveOutputTable&gt; &lt;saveRunStatus&gt;false&lt;/saveRunStatus&gt; &lt;/configuration&gt; &lt;globalParameter&gt; &lt;!-- &lt;fileFix from=&quot;biotic_cruiseNumber_1994001_Anny+KrÃ¦mer.xml&quot; to=&quot;biotic_cruiseNumber_1994001_Anny+Kræmer.xml&quot;/&gt; --&gt; &lt;/globalParameter&gt; &lt;parameters sts=&quot;Barents Sea Northeast Arctic cod bottom trawl index in winter&quot; revision=&quot;1&quot; version=&quot;0.1&quot;&gt; &lt;configuration&gt; &lt;stsName&gt;Barents Sea Northeast Arctic cod bottom trawl index in winter&lt;/stsName&gt; &lt;overwriteNMD&gt;false&lt;/overwriteNMD&gt; &lt;forceReProcess&gt;true&lt;/forceReProcess&gt; &lt;forceBioticV3&gt;true&lt;/forceBioticV3&gt; &lt;skipYear&gt;1993&lt;/skipYear&gt; &lt;startYear&gt;&lt;/startYear&gt; &lt;endYear&gt;&lt;/endYear&gt; &lt;levelRequested&gt;bootstrapImpute&lt;/levelRequested&gt; &lt;bootstrapSeed&gt;77&lt;/bootstrapSeed&gt; &lt;bootstrapImputeSeed&gt;101&lt;/bootstrapImputeSeed&gt; &lt;bootstrapIter&gt;5&lt;/bootstrapIter&gt; &lt;coresUse&gt;1&lt;/coresUse&gt; &lt;groupType&gt;age&lt;/groupType&gt; &lt;minAge&gt;1&lt;/minAge&gt; &lt;maxAge&gt;12&lt;/maxAge&gt; &lt;plusAge&gt;7&lt;/plusAge&gt; &lt;numberScale&gt;1000000&lt;/numberScale&gt; &lt;dataType&gt;survey&lt;/dataType&gt; &lt;applyOverrides&gt;false&lt;/applyOverrides&gt; &lt;/configuration&gt; &lt;override&gt; &lt;!-- &lt;parameter name=&quot;UseProcessData&quot;&gt;true&lt;/parameter&gt; --&gt; &lt;/override&gt; &lt;/parameters&gt; &lt;/redus_master&gt; 3.1.2 2. Multiple survey time series &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;redus_master xmlns=&quot;http://www.imr.no/formats/redus/master/v0.1&quot; revision=&quot;1&quot; version=&quot;0.1&quot;&gt; &lt;configuration&gt; &lt;saveOutputTable&gt;true&lt;/saveOutputTable&gt; &lt;saveRunStatus&gt;false&lt;/saveRunStatus&gt; &lt;/configuration&gt; &lt;globalParameter&gt; &lt;!-- &lt;fileFix from=&quot;biotic_cruiseNumber_1994001_Anny+KrÃ¦mer.xml&quot; to=&quot;biotic_cruiseNumber_1994001_Anny+Kræmer.xml&quot;/&gt; --&gt; &lt;/globalParameter&gt; &lt;parameters sts=&quot;Barents Sea Northeast Arctic cod bottom trawl index in winter&quot; revision=&quot;1&quot; version=&quot;0.1&quot;&gt; &lt;configuration&gt; &lt;stsName&gt;Barents Sea Northeast Arctic cod bottom trawl index in winter&lt;/stsName&gt; &lt;overwriteNMD&gt;false&lt;/overwriteNMD&gt; &lt;forceReProcess&gt;true&lt;/forceReProcess&gt; &lt;forceBioticV3&gt;true&lt;/forceBioticV3&gt; &lt;skipYear&gt;1993&lt;/skipYear&gt; &lt;startYear&gt;&lt;/startYear&gt; &lt;endYear&gt;&lt;/endYear&gt; &lt;levelRequested&gt;bootstrapImpute&lt;/levelRequested&gt; &lt;bootstrapSeed&gt;77&lt;/bootstrapSeed&gt; &lt;bootstrapImputeSeed&gt;101&lt;/bootstrapImputeSeed&gt; &lt;bootstrapIter&gt;5&lt;/bootstrapIter&gt; &lt;coresUse&gt;1&lt;/coresUse&gt; &lt;groupType&gt;age&lt;/groupType&gt; &lt;minAge&gt;1&lt;/minAge&gt; &lt;maxAge&gt;12&lt;/maxAge&gt; &lt;plusAge&gt;7&lt;/plusAge&gt; &lt;numberScale&gt;1000000&lt;/numberScale&gt; &lt;dataType&gt;survey&lt;/dataType&gt; &lt;applyOverrides&gt;false&lt;/applyOverrides&gt; &lt;/configuration&gt; &lt;override&gt; &lt;!-- &lt;parameter name=&quot;UseProcessData&quot;&gt;true&lt;/parameter&gt; --&gt; &lt;/override&gt; &lt;/parameters&gt; &lt;parameters sts=&quot;Barents Sea capelin acoustic abundance estimate in autumn&quot; revision=&quot;1&quot; version=&quot;0.1&quot;&gt; &lt;configuration&gt; &lt;stsName&gt;Barents Sea capelin acoustic abundance estimate in autumn&lt;/stsName&gt; &lt;overwriteNMD&gt;false&lt;/overwriteNMD&gt; &lt;forceReProcess&gt;true&lt;/forceReProcess&gt; &lt;forceBioticV3&gt;true&lt;/forceBioticV3&gt; &lt;skipYear&gt;2016,2019&lt;/skipYear&gt; &lt;startYear&gt;2016&lt;/startYear&gt; &lt;endYear&gt;2020&lt;/endYear&gt; &lt;levelRequested&gt;bootstrapImpute&lt;/levelRequested&gt; &lt;bootstrapSeed&gt;77&lt;/bootstrapSeed&gt; &lt;bootstrapImputeSeed&gt;101&lt;/bootstrapImputeSeed&gt; &lt;bootstrapIter&gt;5&lt;/bootstrapIter&gt; &lt;coresUse&gt;1&lt;/coresUse&gt; &lt;groupType&gt;age&lt;/groupType&gt; &lt;minAge&gt;1&lt;/minAge&gt; &lt;maxAge&gt;12&lt;/maxAge&gt; &lt;plusAge&gt;7&lt;/plusAge&gt; &lt;numberScale&gt;1000000&lt;/numberScale&gt; &lt;dataType&gt;survey&lt;/dataType&gt; &lt;applyOverrides&gt;false&lt;/applyOverrides&gt; &lt;/configuration&gt; &lt;override&gt; &lt;parameter name=&quot;UseProcessData&quot;&gt;true&lt;/parameter&gt; &lt;/override&gt; &lt;/parameters&gt; &lt;/redus_master&gt; 3.2 Usage The recipe can be used in a stand-alone processing or included in the REDUS framework workflow. In brief, the processing of the recipe can be done by using the REDUStools R package (https://github.com/REDUS-IMR/REDUStools). install.packages(&quot;remotes&quot;) remotes::install_github(&quot;REDUS-IMR/REDUStools&quot;) remotes::install_github(&quot;SEA2DATA/Rstox&quot;, ref=&quot;develop&quot;) # Output below can be the processing status or result table # subject to the &#39;saveOutputTable&#39; parameter in the XML recipe output &lt;- REDUStools::processRstoxSTS(&quot;barents_sea_neacod_trawl_winter.xml&quot;) Please see another guide that will explain more on the above stand-alone proces here. 3.3 Parameter details saveOutputTable: Setting this node text to true tells the script to save the resulting table from the StoX process in an rds object on disk. Many of the REDUS framework requires this to be set as true. Setting it to false tells REDUStools::processRstoxSTS() function in the example usage above to return the result table. saveRunStatus: Setting this node text to true tells the script to save the processing status of the survey time series in an rds object on disk. fileFix: This is useful if user want to override data input filename(s) from all the survey time series project.xml files. It will search for a matching string as in the from attribute and replace it to the filename specified in the to attribute. This parameter have a global scope, means it will be affecting all the survey time series in the recipe. parameters: This node contains the unique identifier of the survey time series, please set a unique name for the sts attribute (usually the same name as the survey time series itself). Don’t forget to set the revision and version parameters as well if applicable. stsName: This node text indicates the name of the survey time series that will be processed. The names have to be exactly the same as the name found in NMD Dataset Explorer. overwriteNMD: Setting this node text to true indicates that you want to overwrite the data that you might have downloaded earlier in your local disk. forceReProcess: The script will always re-process the survey time series if set to true. Otherwise it will use the result from the previous process. forceBioticV3: Some recent biotic data from NMD have been saved with NMD Biotic v3.1 format. Since RstoX can’t yet process the data, this switch sometimes necessary to force the header of Biotic v3.1 into Biotic V3. Note that the script won’t change the content of the data. skipYear: Write the years that you want to skip from the processing and separate them using comma sign if you have more that one. Setting this to empty means that you don’t want to skip any years. startYear: The start of year that you want to process. Setting this empty will process the earliest year possible. endYear: The last year that you want to process. Setting this empty will process the survey time series until the last year possible. levelRequested: The StoX output data comes from three possible levels: SuperIndAbundance, bootstrap, and bootstrapImpute. Usually bootstrapImpute is the preferred level of output. bootstrapSeed: Specify a seed value to be used in the bootstrap process. bootstrapImputeSeed: Specify a seed value to be used in the impute process. bootstrapIter: Specify the number of iteration for the bootstrap and impute process. coresUse: Specify the number of cores that will be utilize for the StoX process. groupType: Specify the groupings for the indices. The possible values are age and LenGrp. minAge, maxAge, plusAge: The script will prepare the output table using these age parameters. This won’t affect processing, only the output. numberScale: This value will be used as a multiplier for the output table. This won’t affect processing, only the output. dataType: This is internal identifier for the REDUSframework. Leave it to survey for survey time series. applyOverrides: If set to true, the script will try to override some parameters in the project.xml files for all the year in a survey time series. Populate the &lt;override&gt;&lt;parameter&gt;...&lt;/parameter&gt;&lt;/override&gt; sub-nodes with all overrides that you wish to be applied. For example &lt;parameter name=\"UseProcessData\"&gt;true&lt;/parameter&gt; will search UseProcessData nodes in a project.xml file and set their values to true. You can have multiple overrides for a survey time series. "],["redustools-standalone.html", "4 REDUSTOOLS Standalone Example 4.1 Preparing the master recipe 4.2 Running the process", " 4 REDUSTOOLS Standalone Example This guide shows you a step-by-step guide on how to run a standalone REDUStools with an XML recipe to process a survey time series. 4.1 Preparing the master recipe For this example we will use an the Barents Sea capelin acoustic abundance estimate in autumn survey time series. Below is an example recipe and we save the xml into assets/barents_sea_capelin_acoustic_autumn.xml file. &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;redus_master xmlns=&quot;http://www.imr.no/formats/redus/master/v0.1&quot; revision=&quot;1&quot; version=&quot;0.1&quot;&gt; &lt;configuration&gt; &lt;useLatestRstox&gt;true&lt;/useLatestRstox&gt; &lt;saveOutputTable&gt;true&lt;/saveOutputTable&gt; &lt;saveOutputStatics&gt;true&lt;/saveOutputStatics&gt; &lt;saveRunStatus&gt;true&lt;/saveRunStatus&gt; &lt;generateAssessmentFiles&gt;true&lt;/generateAssessmentFiles&gt; &lt;/configuration&gt; &lt;globalParameter&gt; &lt;!-- &lt;fileFix from=&quot;biotic_cruiseNumber_1994001_Anny+KrÃ¦mer.xml&quot; to=&quot;biotic_cruiseNumber_1994001_Anny+Kræmer.xml&quot;/&gt; --&gt; &lt;/globalParameter&gt; &lt;parameters sts=&quot;Barents Sea capelin acoustic abundance estimate in autumn&quot; revision=&quot;1&quot; version=&quot;0.1&quot;&gt; &lt;configuration&gt; &lt;stsName&gt;Barents Sea capelin acoustic abundance estimate in autumn&lt;/stsName&gt; &lt;overwriteNMD&gt;false&lt;/overwriteNMD&gt; &lt;forceReProcess&gt;true&lt;/forceReProcess&gt; &lt;forceBioticV3&gt;true&lt;/forceBioticV3&gt; &lt;skipYear&gt;&lt;/skipYear&gt; &lt;startYear&gt;2018&lt;/startYear&gt; &lt;endYear&gt;2019&lt;/endYear&gt; &lt;levelRequested&gt;bootstrapImpute&lt;/levelRequested&gt; &lt;bootstrapSeed&gt;77&lt;/bootstrapSeed&gt; &lt;bootstrapImputeSeed&gt;101&lt;/bootstrapImputeSeed&gt; &lt;bootstrapIter&gt;5&lt;/bootstrapIter&gt; &lt;coresUse&gt;1&lt;/coresUse&gt; &lt;groupType&gt;age&lt;/groupType&gt; &lt;minAge&gt;1&lt;/minAge&gt; &lt;maxAge&gt;12&lt;/maxAge&gt; &lt;plusAge&gt;7&lt;/plusAge&gt; &lt;numberScale&gt;1000000&lt;/numberScale&gt; &lt;dataType&gt;survey&lt;/dataType&gt; &lt;applyOverrides&gt;false&lt;/applyOverrides&gt; &lt;/configuration&gt; &lt;override&gt; &lt;!-- &lt;parameter name=&quot;UseProcessData&quot;&gt;true&lt;/parameter&gt; --&gt; &lt;/override&gt; &lt;/parameters&gt; &lt;/redus_master&gt; 4.2 Running the process 4.2.1 Setup First, we setup and install the necessary packages. Setting up the environment is necessary, otherwise by default REDUStools will try to use the /data/REDUS directory which might not available in your running platform. install.packages(&quot;remotes&quot;) remotes::install_github(&quot;SEA2DATA/Rstox&quot;, ref=&quot;develop&quot;) remotes::install_github(&quot;REDUS-IMR/REDUStools&quot;) # Without the below command, the result data will be put in /data/REDUS directory # or REDUStools:::getConfig()$root.dir # Setting it to &quot;docker&quot; means we will use the current active directory Sys.setenv(R_CONFIG_ACTIVE = &quot;docker&quot;) 4.2.2 Process Now we process the survey time series. Wait for a while as it can take some time to finish. In the end we will print out the processing status. # Run process! status &lt;- REDUStools::processRstoxSTS(&quot;assets/barents_sea_capelin_acoustic_autumn.xml&quot;) print(status) 4.2.3 Examine data After the above is finised, let’s load the data to examine it. # Get the data stsdata &lt;- REDUStools::loadSTS(&quot;Barents Sea capelin acoustic abundance estimate in autumn&quot;) # Get the metadata print(stsdata$meta) ## $stsName ## [1] &quot;Barents Sea capelin acoustic abundance estimate in autumn&quot; ## ## $overwriteNMD ## [1] &quot;false&quot; ## ## $forceReProcess ## [1] &quot;true&quot; ## ## $forceBioticV3 ## [1] &quot;true&quot; ## ## $skipYear ## [1] &quot;&quot; ## ## $startYear ## [1] &quot;2018&quot; ## ## $endYear ## [1] &quot;2019&quot; ## ## $levelRequested ## [1] &quot;bootstrapImpute&quot; ## ## $bootstrapSeed ## [1] &quot;77&quot; ## ## $bootstrapImputeSeed ## [1] &quot;101&quot; ## ## $bootstrapIter ## [1] &quot;5&quot; ## ## $coresUse ## [1] &quot;1&quot; ## ## $groupType ## [1] &quot;age&quot; ## ## $minAge ## [1] &quot;1&quot; ## ## $maxAge ## [1] &quot;12&quot; ## ## $plusAge ## [1] &quot;7&quot; ## ## $numberScale ## [1] &quot;1000000&quot; ## ## $dataType ## [1] &quot;survey&quot; ## ## $applyOverrides ## [1] &quot;false&quot; print(stsdata$fp) ## $buildTime ## [1] &quot;Wed Sep 22 10:48:40 2021&quot; ## ## $masterRev ## [1] &quot;da572dd7aa46857b9cddc98ef4ad72df79f8fe2c&quot; ## ## $rstoxRev ## [1] &quot;41beebdf85a1b6c0b29b8e436b6f42d2d738d6a6&quot; ## ## $rstoxVer ## [1] &quot;1.11.1&quot; ## ## $RVer ## [1] &quot;R version 4.0.5 (2021-03-31)&quot; # Get the data print(stsdata$data) ## year .id age Ab.Sum Weight.Sum ## 1: 2018 1 NA NA NA ## 2: 2018 1 0 1.858158e+08 454321187 ## 3: 2018 1 1 5.658849e+10 267453782819 ## 4: 2018 1 2 5.127899e+10 722402520609 ## 5: 2018 1 3 1.940289e+10 455744734005 ## 6: 2018 1 4 6.479721e+07 1620497372 ## 7: 2018 1 5 NA NA ## 8: 2018 2 NA NA NA ## 9: 2018 2 0 NA NA ## 10: 2018 2 1 7.047482e+10 349774718001 ## 11: 2018 2 2 6.908417e+10 947886811679 ## 12: 2018 2 3 2.261514e+10 522400804296 ## 13: 2018 2 4 6.114607e+08 18433955563 ## 14: 2018 2 5 NA NA ## 15: 2018 3 NA NA NA ## 16: 2018 3 0 2.603217e+08 520643347 ## 17: 2018 3 1 4.544111e+10 215385339537 ## 18: 2018 3 2 6.386157e+10 911724193299 ## 19: 2018 3 3 2.324392e+10 550167185382 ## 20: 2018 3 4 3.316548e+08 9108207475 ## 21: 2018 3 5 6.766864e+05 24360709 ## 22: 2018 4 NA NA NA ## 23: 2018 4 0 1.332267e+08 205449264 ## 24: 2018 4 1 7.506643e+10 394085788882 ## 25: 2018 4 2 7.204304e+10 916212362924 ## 26: 2018 4 3 1.788082e+10 378488646657 ## 27: 2018 4 4 3.223851e+08 8599669368 ## 28: 2018 4 5 3.915266e+06 133119057 ## 29: 2018 5 NA 5.228091e+06 240492163 ## 30: 2018 5 0 1.697118e+08 339423576 ## 31: 2018 5 1 5.468721e+10 261815864238 ## 32: 2018 5 2 5.142159e+10 673885776263 ## 33: 2018 5 3 1.139378e+10 232508748394 ## 34: 2018 5 4 1.347231e+08 3608628164 ## 35: 2018 5 5 2.481954e+06 90591328 ## 36: 2019 1 NA 6.167043e+07 1490637572 ## 37: 2019 1 1 1.974878e+10 85465126380 ## 38: 2019 1 2 1.445034e+10 210927048730 ## 39: 2019 1 3 9.356174e+09 224004815530 ## 40: 2019 1 4 1.947998e+09 52440068749 ## 41: 2019 1 5 NA NA ## 42: 2019 2 NA 3.952683e+07 928175090 ## 43: 2019 2 1 2.009545e+10 79761515603 ## 44: 2019 2 2 1.434316e+10 203721867124 ## 45: 2019 2 3 7.205293e+09 179309120691 ## 46: 2019 2 4 1.378739e+09 35294581838 ## 47: 2019 2 5 5.876453e+07 1126320196 ## 48: 2019 3 NA 1.016105e+07 161258027 ## 49: 2019 3 1 1.939539e+10 107353585833 ## 50: 2019 3 2 6.151520e+09 85506300359 ## 51: 2019 3 3 4.102326e+09 90292191890 ## 52: 2019 3 4 8.883581e+08 22206357748 ## 53: 2019 3 5 NA NA ## 54: 2019 4 NA 1.932162e+07 97710541 ## 55: 2019 4 1 1.969037e+10 113019879620 ## 56: 2019 4 2 7.499155e+09 108603894416 ## 57: 2019 4 3 4.110904e+09 90754185897 ## 58: 2019 4 4 7.817540e+08 18208339390 ## 59: 2019 4 5 NA NA ## 60: 2019 5 NA 5.635425e+07 0 ## 61: 2019 5 1 1.968001e+10 93567753075 ## 62: 2019 5 2 1.324392e+10 179881310966 ## 63: 2019 5 3 5.883584e+09 140796382520 ## 64: 2019 5 4 9.236369e+08 22534407539 ## 65: 2019 5 5 6.404967e+06 118491889 ## year .id age Ab.Sum Weight.Sum # Get the data (lengthgroup-based) print(stsdata$data2) ## year .id LenGrp age Ab.Sum Weight.Sum ## 1: 2018 1 8 NA NA NA ## 2: 2018 1 8 0 185815828 454321187 ## 3: 2018 1 8 1 6278731952 13913299442 ## 4: 2018 1 8 2 NA NA ## 5: 2018 1 8 3 NA NA ## --- ## 1676: 2019 5 20 1 NA NA ## 1677: 2019 5 20 2 NA NA ## 1678: 2019 5 20 3 NA NA ## 1679: 2019 5 20 4 NA NA ## 1680: 2019 5 20 5 NA NA # Note that &quot;.id&quot; column means the bootstrap id number (see in the .xml file for the number of bootstrap done) 4.2.4 (Optional) Making a nice single page visualization You can generate a nice static page with graphs and tables (also in PDF and CSV formats) by running this piece of code below. # Now make a nice multi-format output: REDUStools:::createStaticOutput(&quot;Barents Sea capelin acoustic abundance estimate in autumn&quot;, &quot;./out&quot;) # Point your browser to: # ./out/Barents Sea capelin acoustic abundance estimate in autumn/output/index.html Below is an example of the output. The full output contains many other output formats. Abundance Age group ( x 1e+06 ) Year 0 1 2 3 4 5 2018 187 . 27 60451 . 61 61537 . 87 18907 . 31 293 . 00 2 . 36 2019 0 . 00 19722 . 00 11137 . 62 6131 . 66 1184 . 10 32 . 58 Weight Age group (in grams) Year 0 1 2 3 4 5 2018 2 . 03 4 . 92 13 . 56 22 . 63 28 . 24 35 . 07 2019 0 . 00 4 . 86 14 . 16 23 . 65 25 . 45 19 . 10 Metadata param value 1 buildTime Wed Sep 22 10:48:40 2021 2 masterRev da572dd7aa46857b9cddc98ef4ad72df79f8fe2c 3 rstoxRev 41beebdf85a1b6c0b29b8e436b6f42d2d738d6a6 4 rstoxVer 1.11.1 5 RVer R version 4.0.5 (2021-03-31) "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
